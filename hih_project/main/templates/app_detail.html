{% extends 'base.html' %}
{% load static %}

{% block title %}
{{ app.name }} - HiH Store
{% endblock %}

{% block content %}
<div class="app_detail_page">
    <div class="app_detail_page_header">
        <div class="app_detail_page_icon">
            {% if app.icon %}
                <img src="{{ app.icon.url }}" alt="{{ app.name }}" class="app_detail_page_icon_img">
            {% else %}
                <div class="app_detail_page_icon_placeholder">üì±</div>
            {% endif %}
        </div>
        
        <div class="app_detail_page_info">
            <h1 class="app_detail_page_title">{{ app.name }}</h1>
            <a href="{% url 'developer' dev_id=app.developer.id %}" class="app_detail_page_developer">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: <span style="color:slateblue"><b>{{ app.developer.name }}</b></span> </a>
            <br><br>
            <div class="app_detail_page_meta">
                <div class="app_detail_page_rating">–†–µ–π—Ç–∏–Ω–≥: {{ app.rating|floatformat:1 }} <span>({{ app.estimations_count }})</span></div>
                <div class="app_detail_page_downloads">–°–∫–∞—á–∏–≤–∞–Ω–∏–π: {{ app.downloads }}</div>
                <div class="app_detail_page_size">–í–µ—Å: {{ app.size|filesizeformat }}</div>
            </div>
            
            <button class="app_detail_page_download_btn">–°–∫–∞—á–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="app_detail_page_content">
        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
        <div class="app_detail_page_section">
            <h2>–û–ø–∏—Å–∞–Ω–∏–µ</h2>
            <p class="app_detail_page_description">{{ app.description }}</p>
        </div>

        <!-- –î–µ—Ç–∞–ª–∏ -->
        <div class="app_detail_page_section">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <div class="app_detail_page_details">
                <div class="app_detail_page_detail_item">
                    <span class="app_detail_page_detail_label">::–ñ–∞–Ω—Ä:</span>
                    <span class="app_detail_page_detail_value">{{ app.subcategory.category.name }}</span>
                </div>
                <div class="app_detail_page_detail_item">
                    <span class="app_detail_page_detail_label">–ü–æ–¥–∂–∞–Ω—Ä:</span>
                    <span class="app_detail_page_detail_value">{{ app.subcategory.name }}</span>
                </div>
                <div class="app_detail_page_detail_item">
                    <span class="app_detail_page_detail_label">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:</span>
                    <span class="app_detail_page_detail_value">{{ app.developer.name }}</span>
                </div>
                <div class="app_detail_page_detail_item">
                    <span class="app_detail_page_detail_label">–í–æ–∑—Ä–∞—Å—Ç:</span>
                    <span class="app_detail_page_detail_value">{{ app.age_rating.min_age }}+</span>
                </div>
                <div class="app_detail_page_detail_item">
                    <span class="app_detail_page_detail_label">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã:</span>
                    <span class="app_detail_page_detail_value">{{ app.views }}</span>
                </div>
            </div>
        </div>

        <div class="app_estimations_page_section">
            <h2>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h2>
            {% if user.is_authenticated %}
                <form method="post">
                    {% csrf_token %}
                    {{ form.estimation }}
                    {{ form.estimation_content }}
                    <button type="submit" name="submit" value="estimate">
                        {% if user_estimation_exists %}
                            –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–∑—ã–≤
                        {% else %}
                            –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
                        {% endif %}
                    </button>
                </form>
            {% else %}
                <span>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤!</span>
            {% endif %}
            <h2>–û—Ç–∑—ã–≤—ã</h2>
            {% for estimation in estimations %}
                {% if estimation.author and estimation.content %}
                    <div class="app_estimation">
                        <span class="app_estimation_value">{{ estimation.estimation }}</span>
                        <span class="app_estimation_author_name">{{ estimation.author.username }}</span>
                        <span class="app_estimation_content">{{ estimation.content }}</span>
                        <span class="app_estimation_publishing_date">{{ estimation.published_at|date:"d F Y H:i" }}</span>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}