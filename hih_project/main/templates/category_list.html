{% extends 'base.html' %}
{% load static %}

{% block title %}
–í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ - HiH Store
{% endblock %}

{% block content %}
<div class="category_list_page">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="category_list_header">
        <h1 class="category_list_title">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h1>
        <p class="category_list_subtitle">–ù–∞–π–¥–∏—Ç–µ –∏–≥—Ä—ã –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º</p>
    </div>

    <!-- –§–æ—Ä–º–∞ –≤—ã–±–æ—Ä–∞ -->
    <div class="category_list_form_section">
        <form method="get" action="{% url 'apps' %}" class="category_list_form">
            <!-- –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div class="category_list_form_group">
                <label class="category_list_form_label">–ì–ª–∞–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <select name="category" class="category_list_select" id="category-select" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- –í—ã–±–æ—Ä –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div class="category_list_form_group">
                <label class="category_list_form_label">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <select name="subcategory" class="category_list_select" id="subcategory-select" disabled required>
                    <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                </select>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ -->
            <button type="submit" class="category_list_submit_btn">–ü–æ–∫–∞–∑–∞—Ç—å –∏–≥—Ä—ã</button>
        </form>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
    <div class="category_list_quick_categories">
        <h2 class="category_list_section_title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
        <div class="category_list_grid">
            {% for category in categories %}
            <div class="category_list_quick_card" data-category-id="{{ category.id }}">
                <div class="category_list_icon">
                    {% if category.icon %}
                        <img src="{{ category.icon.url }}" alt="{{ category.name }}">
                    {% else %}
                        <div class="category_list_icon_placeholder">üéÆ</div>
                    {% endif %}
                </div>
                <div class="category_list_info">
                    <h3 class="category_list_name">{{ category.name }}</h3>
                    <p class="category_list_description">{{ category.description }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- –ü—Ä–æ—Å—Ç–æ–π JavaScript –¥–ª—è —Ñ–æ—Ä–º—ã -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const categorySelect = document.getElementById('category-select');
    const subcategorySelect = document.getElementById('subcategory-select');
    
    // –î–∞–Ω–Ω—ã–µ –æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö (–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ AJAX, –Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Å–¥–µ–ª–∞–µ–º —Å—Ç–∞—Ç–∏—á–Ω–æ)
    const subcategoriesData = {
        {% for category in categories %}
        '{{ category.id }}': [
            {% for subcategory in category.appsubcategory_set.all %}
            { id: '{{ subcategory.id }}', name: '{{ subcategory.name }}' },
            {% endfor %}
        ],
        {% endfor %}
    };

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    categorySelect.addEventListener('change', function() {
        const categoryId = this.value;
        const subcategories = subcategoriesData[categoryId];
        
        subcategorySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
        subcategorySelect.disabled = !categoryId;
        
        if (categoryId && subcategories) {
            subcategories.forEach(function(subcategory) {
                const option = document.createElement('option');
                option.value = subcategory.id;
                option.textContent = subcategory.name;
                subcategorySelect.appendChild(option);
            });
            subcategorySelect.disabled = false;
        }
    });

    // –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    document.querySelectorAll('.category_list_quick_card').forEach(function(card) {
        card.addEventListener('click', function() {
            const categoryId = this.getAttribute('data-category-id');
            categorySelect.value = categoryId;
            categorySelect.dispatchEvent(new Event('change'));
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —Ñ–æ—Ä–º–µ
            document.querySelector('.category_list_form_section').scrollIntoView({
                behavior: 'smooth'
            });
        });
    });
});
</script>
{% endblock %}